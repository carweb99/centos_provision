#!/usr/bin/env bash
set -e -x -o pipefail

if test "$#" -ne 1; then
    echo "Usage: ./notify TEXT"
fi

if [[ -z "$SLACK_WEBHOOK" ]]
then
      echo "\$SLACK_WEBHOOK is empty";
      exit 1;
fi

json_escape () {
    printf '%s' "$1" | python -c 'import json,sys; print(json.dumps(sys.stdin.read()))'
}

text=`json_escape ${1}`

curl "${SLACK_WEBHOOK}" -X POST --data "{\"text\": \"${text}\"}" -H 'Content-type: application/json'
